generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id         String       @id @default(uuid())
  first_name String
  last_name  String
  email      String       @unique
  password   String
  created_at DateTime     @default(now())
  updated_at DateTime     @updatedAt
  chats      Chat[]
  status     UserStatus   @default(ACTIVE)
  profile    UserProfile?
  health     UserHealth?
}

model UserProfile {
  id         String   @id @default(uuid())
  user_id    String   @unique
  user       User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  weight     Float? // in kg
  height     Float? // in cm
  age        Int?
  sex        Sex?
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@index([user_id])
}

model UserHealth {
  id                   String         @id @default(uuid())
  user_id              String         @unique
  user                 User           @relation(fields: [user_id], references: [id], onDelete: Cascade)
  activity_level       ActivityLevel?
  goal                 Goal?
  dietary_restrictions String[]
  medical_conditions   String[]
  allergies            String[]
  created_at           DateTime       @default(now())
  updated_at           DateTime       @updatedAt

  @@index([user_id])
}

model Chat {
  id         String    @id @default(uuid())
  title      String
  user_id    String
  user       User      @relation(fields: [user_id], references: [id], onDelete: Cascade)
  messages   Message[]
  created_at DateTime  @default(now())
  updated_at DateTime  @updatedAt

  @@index([user_id])
}

model Message {
  id           String      @id @default(uuid())
  chat_id      String
  chat         Chat        @relation(fields: [chat_id], references: [id], onDelete: Cascade)
  role         MessageRole
  content_type ContentType @default(TEXT)
  content      Json
  created_at   DateTime    @default(now())
  updated_at   DateTime    @updatedAt

  @@index([chat_id])
  @@index([created_at])
}

enum MessageRole {
  USER
  ASSISTANT
}

enum ContentType {
  TEXT
  AUDIO
  IMAGE
  MIXED
}

enum UserStatus {
  ACTIVE
  INACTIVE
}

enum Sex {
  MALE
  FEMALE
  OTHER
}

enum ActivityLevel {
  SEDENTARY 
  LIGHTLY_ACTIVE
  MODERATELY_ACTIVE
  VERY_ACTIVE
  EXTRA_ACTIVE
}

enum Goal {
  WEIGHT_LOSS
  WEIGHT_GAIN
  MAINTENANCE
  MUSCLE_GAIN
  HEALTH_IMPROVEMENT
  SPORTS_PERFORMANCE
  GENERAL_WELLNESS
}
